local Seraph = {
    Themes = {
        Pure = {
            Main = Color3.fromRGB(10, 10, 12),
            Sub = Color3.fromRGB(18, 18, 22),
            Section = Color3.fromRGB(15, 15, 18),
            Component = Color3.fromRGB(22, 22, 26),
            Stroke = Color3.fromRGB(35, 35, 40),
            Accent = Color3.fromRGB(120, 110, 255),
            Text = Color3.fromRGB(240, 240, 240),
            SecondaryText = Color3.fromRGB(150, 150, 160),
            Hover = Color3.fromRGB(40, 40, 48)
        }
    }
}

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local Parent =
    (RunService:IsStudio() and Players.LocalPlayer:WaitForChild("PlayerGui")) or (gethui and gethui()) or CoreGui

local function Create(class, props, children)
    local obj = Instance.new(class)
    for i, v in pairs(props) do
        if i ~= "Parent" then
            obj[i] = v
        end
    end
    if children then
        for _, child in ipairs(children) do
            child.Parent = obj
        end
    end
    obj.Parent = props.Parent
    return obj
end

function Seraph:CreateWindow(cfg)
    cfg = cfg or {}
    local Theme = Seraph.Themes.Pure
    local TitleText = cfg.Title or "SERAPH"
    local SubTitle = cfg.SubTitle or "ADVANCED V4"

    local GUI = Create("ScreenGui", {Name = "SeraphV4", Parent = Parent, IgnoreGuiInset = true, ResetOnSpawn = false})

    local MainSize = Vector2.new(580, 440)
    local Main =
        Create(
        "Frame",
        {
            Name = "Main",
            Size = UDim2.new(0, MainSize.X, 0, MainSize.Y),
            Position = UDim2.new(0.5, -MainSize.X / 2, 0.5, -MainSize.Y / 2),
            BackgroundColor3 = Theme.Main,
            Parent = GUI,
            Active = true,
            BorderSizePixel = 0,
            ClipsDescendants = true
        },
        {
            Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
            Create("UIStroke", {Color = Theme.Stroke, Thickness = 1})
        }
    )

    -- Improved Dragging logic
    local dragStart, startPos, dragging
    Main.InputBegan:Connect(
        function(input)
            if
                (input.UserInputType == Enum.UserInputType.MouseButton1 or
                    input.UserInputType == Enum.UserInputType.Touch)
             then
                dragging = true
                dragStart = input.Position
                startPos = Main.Position
            end
        end
    )
    UserInputService.InputChanged:Connect(
        function(input)
            if
                dragging and
                    (input.UserInputType == Enum.UserInputType.MouseMovement or
                        input.UserInputType == Enum.UserInputType.Touch)
             then
                local delta = input.Position - dragStart
                Main.Position =
                    UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            end
        end
    )
    UserInputService.InputEnded:Connect(
        function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end
    )

    -- ADVANCED TOPBAR
    local TopBar =
        Create(
        "Frame",
        {
            Name = "TopBar",
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = Theme.Sub,
            BorderSizePixel = 0,
            Parent = Main
        },
        {
            Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
            Create(
                "Frame",
                {
                    -- Gap cover
                    Size = UDim2.new(1, 0, 0, 10),
                    Position = UDim2.new(0, 0, 1, -10),
                    BackgroundColor3 = Theme.Sub,
                    BorderSizePixel = 0
                }
            ),
            Create(
                "Frame",
                {
                    -- Bottom Divider Line
                    Size = UDim2.new(1, 0, 0, 1),
                    Position = UDim2.new(0, 0, 1, 0),
                    BackgroundColor3 = Theme.Stroke,
                    BorderSizePixel = 0
                }
            ),
            Create(
                "UIGradient",
                {
                    Color = ColorSequence.new(
                        {
                            ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                            ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 200))
                        }
                    ),
                    Rotation = 90
                }
            )
        }
    )

    -- Logo and Title Group
    local TitleGroup =
        Create(
        "Frame",
        {
            Size = UDim2.new(0.6, 0, 1, 0),
            BackgroundTransparency = 1,
            Parent = TopBar
        },
        {
            Create(
                "UIListLayout",
                {
                    FillDirection = Enum.FillDirection.Horizontal,
                    VerticalAlignment = Enum.VerticalAlignment.Center,
                    Padding = UDim.new(0, 10)
                }
            ),
            Create("UIPadding", {PaddingLeft = UDim.new(0, 12)})
        }
    )

    -- Advanced Icon
    Create(
        "ImageLabel",
        {
            Name = "Icon",
            Size = UDim2.new(0, 20, 0, 20),
            Image = "rbxassetid://6031068420", -- Example sparkle/seraph icon
            ImageColor3 = Theme.Accent,
            BackgroundTransparency = 1,
            Parent = TitleGroup
        }
    )

    -- Main Title
    Create(
        "TextLabel",
        {
            Text = TitleText,
            AutomaticSize = Enum.AutomaticSize.X,
            Size = UDim2.new(0, 0, 1, 0),
            TextColor3 = Theme.Text,
            TextSize = 14,
            Font = Enum.Font.GothamBold,
            BackgroundTransparency = 1,
            Parent = TitleGroup
        }
    )

    -- Separator
    Create(
        "Frame",
        {
            Size = UDim2.new(0, 1, 0, 14),
            BackgroundColor3 = Theme.Stroke,
            BorderSizePixel = 0,
            Parent = TitleGroup
        }
    )

    -- Sub-title Tag
    Create(
        "TextLabel",
        {
            Text = SubTitle,
            AutomaticSize = Enum.AutomaticSize.X,
            Size = UDim2.new(0, 0, 1, 0),
            TextColor3 = Theme.SecondaryText,
            TextSize = 11,
            Font = Enum.Font.GothamMedium,
            BackgroundTransparency = 1,
            Parent = TitleGroup
        }
    )

    -- Control Buttons Holder
    local Controls =
        Create(
        "Frame",
        {
            Size = UDim2.new(0.4, 0, 1, 0),
            Position = UDim2.new(0.6, 0, 0, 0),
            BackgroundTransparency = 1,
            Parent = TopBar
        },
        {
            Create(
                "UIListLayout",
                {
                    FillDirection = Enum.FillDirection.Horizontal,
                    HorizontalAlignment = Enum.HorizontalAlignment.Right,
                    VerticalAlignment = Enum.VerticalAlignment.Center,
                    Padding = UDim.new(0, 5)
                }
            ),
            Create("UIPadding", {PaddingRight = UDim.new(0, 10)})
        }
    )

    local function CreateTopBtn(icon, color)
        local btn =
            Create(
            "TextButton",
            {
                Text = icon,
                Size = UDim2.new(0, 28, 0, 28),
                BackgroundColor3 = Theme.Component,
                TextColor3 = color or Theme.SecondaryText,
                Font = Enum.Font.GothamMedium,
                TextSize = 18,
                AutoButtonColor = false,
                Parent = Controls
            },
            {
                Create("UICorner", {CornerRadius = UDim.new(0, 4)}),
                Create("UIStroke", {Color = Theme.Stroke})
            }
        )
        btn.MouseEnter:Connect(
            function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Hover}):Play()
            end
        )
        btn.MouseLeave:Connect(
            function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Component}):Play()
            end
        )
        return btn
    end

    local MinBtn = CreateTopBtn("-")
    local CloseBtn = CreateTopBtn("Ã—", Color3.fromRGB(255, 100, 100))

    -- MINIMIZE LOGIC
    local IsMinimized = false
    MinBtn.MouseButton1Click:Connect(
        function()
            IsMinimized = not IsMinimized
            local targetSize =
                IsMinimized and UDim2.new(0, MainSize.X, 0, 40) or UDim2.new(0, MainSize.X, 0, MainSize.Y)
            TweenService:Create(
                Main,
                TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
                {Size = targetSize}
            ):Play()
            MinBtn.Text = IsMinimized and "+" or "-"
        end
    )

    CloseBtn.MouseButton1Click:Connect(
        function()
            GUI:Destroy()
        end
    )

    -- UI NAVIGATION AREA
    local Sidebar =
        Create(
        "Frame",
        {
            Size = UDim2.new(0, 160, 1, -40),
            Position = UDim2.new(0, 0, 0, 40),
            BackgroundColor3 = Theme.Sub,
            BorderSizePixel = 0,
            Parent = Main
        },
        {
            Create(
                "Frame",
                {
                    -- Vertical Line
                    Size = UDim2.new(0, 1, 1, 0),
                    Position = UDim2.new(1, 0, 0, 0),
                    BackgroundColor3 = Theme.Stroke,
                    BorderSizePixel = 0
                }
            )
        }
    )

    local TabHolder =
        Create(
        "ScrollingFrame",
        {
            Size = UDim2.new(1, 0, 1, -10),
            Position = UDim2.new(0, 0, 0, 5),
            BackgroundTransparency = 1,
            ScrollBarThickness = 0,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Parent = Sidebar
        },
        {
            Create("UIListLayout", {Padding = UDim.new(0, 2), HorizontalAlignment = Enum.HorizontalAlignment.Center})
        }
    )

    local Container =
        Create(
        "Frame",
        {
            Size = UDim2.new(1, -170, 1, -50),
            Position = UDim2.new(0, 165, 0, 45),
            BackgroundTransparency = 1,
            Parent = Main
        }
    )

    local Window = {Tabs = {}, ActiveTab = nil}

    -- Reuse original ApplyBaseUX logic with minor styling improvements...
    local function ApplyBaseUX(object, target)
        function object:AddButton(text, callback)
            local Btn =
                Create(
                "TextButton",
                {
                    Text = text,
                    Size = UDim2.new(1, -10, 0, 32),
                    BackgroundColor3 = Theme.Component,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 12,
                    AutoButtonColor = false,
                    Parent = target
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 4)}),
                    Create("UIStroke", {Color = Theme.Stroke})
                }
            )
            Btn.MouseEnter:Connect(
                function()
                    TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Hover}):Play()
                end
            )
            Btn.MouseLeave:Connect(
                function()
                    TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Component}):Play()
                end
            )
            Btn.MouseButton1Click:Connect(
                function()
                    task.spawn(callback)
                end
            )
            return Btn
        end

        function object:AddToggle(text, default, callback)
            local state = default or false
            local Togg =
                Create(
                "TextButton",
                {
                    Text = "",
                    Size = UDim2.new(1, -10, 0, 32),
                    BackgroundColor3 = Theme.Component,
                    Parent = target,
                    AutoButtonColor = false
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 4)}),
                    Create("UIStroke", {Color = Theme.Stroke}),
                    Create(
                        "TextLabel",
                        {
                            Text = text,
                            Size = UDim2.new(1, -40, 1, 0),
                            Position = UDim2.new(0, 10, 0, 0),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.Text,
                            TextXAlignment = Enum.TextXAlignment.Left,
                            Font = Enum.Font.Gotham,
                            TextSize = 12
                        }
                    ),
                    Create(
                        "Frame",
                        {
                            Name = "Status",
                            Size = UDim2.new(0, 18, 0, 10),
                            Position = UDim2.new(1, -28, 0.5, -5),
                            BackgroundColor3 = state and Theme.Accent or Theme.Main
                        },
                        {
                            Create("UICorner", {CornerRadius = UDim.new(1, 0)})
                        }
                    )
                }
            )
            Togg.MouseButton1Click:Connect(
                function()
                    state = not state
                    TweenService:Create(
                        Togg.Status,
                        TweenInfo.new(0.2),
                        {BackgroundColor3 = state and Theme.Accent or Theme.Main}
                    ):Play()
                    task.spawn(callback, state)
                end
            )
        end

        function object:AddSlider(text, min, max, default, callback)
            local val = math.clamp(default or min, min, max)
            local SliderFrame =
                Create(
                "Frame",
                {
                    Size = UDim2.new(1, -10, 0, 45),
                    BackgroundColor3 = Theme.Component,
                    Parent = target
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 4)}),
                    Create("UIStroke", {Color = Theme.Stroke}),
                    Create(
                        "TextLabel",
                        {
                            Text = text,
                            Size = UDim2.new(1, -20, 0, 25),
                            Position = UDim2.new(0, 10, 0, 2),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.Text,
                            Font = Enum.Font.Gotham,
                            TextSize = 12,
                            TextXAlignment = Enum.TextXAlignment.Left
                        }
                    ),
                    Create(
                        "TextLabel",
                        {
                            Name = "Val",
                            Text = tostring(val),
                            Size = UDim2.new(0, 40, 0, 25),
                            Position = UDim2.new(1, -50, 0, 2),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.SecondaryText,
                            Font = Enum.Font.GothamBold,
                            TextSize = 11,
                            TextXAlignment = Enum.TextXAlignment.Right
                        }
                    )
                }
            )

            local SliderBack =
                Create(
                "Frame",
                {
                    Size = UDim2.new(1, -20, 0, 4),
                    Position = UDim2.new(0, 10, 1, -12),
                    BackgroundColor3 = Theme.Main,
                    Parent = SliderFrame
                },
                {Create("UICorner", {CornerRadius = UDim.new(0, 2)})}
            )

            local SliderFill =
                Create(
                "Frame",
                {
                    Size = UDim2.new((val - min) / (max - min), 0, 1, 0),
                    BackgroundColor3 = Theme.Accent,
                    Parent = SliderBack
                },
                {Create("UICorner", {CornerRadius = UDim.new(0, 2)})}
            )

            local function UpdateSlider(input)
                local sizeX = SliderBack.AbsoluteSize.X
                local delta = math.clamp((input.Position.X - SliderBack.AbsolutePosition.X) / sizeX, 0, 1)
                local newValue = math.floor(min + (max - min) * delta)
                SliderFill.Size = UDim2.new(delta, 0, 1, 0)
                SliderFrame.Val.Text = tostring(newValue)
                task.spawn(callback, newValue)
            end

            local sliding = false
            SliderFrame.InputBegan:Connect(
                function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        sliding = true
                        UpdateSlider(input)
                    end
                end
            )
            UserInputService.InputChanged:Connect(
                function(input)
                    if sliding and input.UserInputType == Enum.UserInputType.MouseMovement then
                        UpdateSlider(input)
                    end
                end
            )
            UserInputService.InputEnded:Connect(
                function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        sliding = false
                    end
                end
            )
        end
    end

    function Window:AddTab(name)
        local Tab = {Page = nil, TabBtn = nil}
        local TabBtn =
            Create(
            "TextButton",
            {
                Text = "",
                Size = UDim2.new(1, -12, 0, 34),
                BackgroundTransparency = 1,
                Parent = TabHolder
            },
            {
                Create(
                    "TextLabel",
                    {
                        Name = "L",
                        Text = name,
                        Size = UDim2.new(1, -10, 1, 0),
                        Position = UDim2.new(0, 10, 0, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = Theme.SecondaryText,
                        TextSize = 12,
                        Font = Enum.Font.GothamMedium,
                        TextXAlignment = Enum.TextXAlignment.Left
                    }
                )
            }
        )

        local Page =
            Create(
            "ScrollingFrame",
            {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Visible = false,
                ScrollBarThickness = 2,
                ScrollBarImageColor3 = Theme.Stroke,
                CanvasSize = UDim2.new(0, 0, 0, 0),
                AutomaticCanvasSize = Enum.AutomaticSize.Y,
                Parent = Container
            },
            {
                Create(
                    "UIListLayout",
                    {Padding = UDim.new(0, 8), HorizontalAlignment = Enum.HorizontalAlignment.Center}
                ),
                Create("UIPadding", {PaddingTop = UDim.new(0, 5)})
            }
        )

        function Tab:Select()
            if Window.ActiveTab then
                Window.ActiveTab.Page.Visible = false
                Window.ActiveTab.TabBtn.L.TextColor3 = Theme.SecondaryText
            end
            Window.ActiveTab = Tab
            Page.Visible = true
            TabBtn.L.TextColor3 = Theme.Accent
        end

        TabBtn.MouseButton1Click:Connect(
            function()
                Tab:Select()
            end
        )

        function Tab:AddSection(title)
            local Sect = {}
            local SectCont =
                Create(
                "Frame",
                {
                    Size = UDim2.new(1, -10, 0, 0),
                    BackgroundColor3 = Theme.Section,
                    AutomaticSize = Enum.AutomaticSize.Y,
                    Parent = Page
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 5)}),
                    Create("UIStroke", {Color = Theme.Stroke}),
                    Create(
                        "TextLabel",
                        {
                            Text = title:upper(),
                            Size = UDim2.new(1, -12, 0, 28),
                            Position = UDim2.new(0, 10, 0, 2),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.Accent,
                            Font = Enum.Font.GothamBold,
                            TextSize = 10,
                            TextXAlignment = Enum.TextXAlignment.Left
                        }
                    ),
                    Create(
                        "Frame",
                        {
                            Name = "C",
                            Size = UDim2.new(1, 0, 0, 0),
                            Position = UDim2.new(0, 0, 0, 28),
                            BackgroundTransparency = 1,
                            AutomaticSize = Enum.AutomaticSize.Y
                        },
                        {
                            Create(
                                "UIListLayout",
                                {Padding = UDim.new(0, 6), HorizontalAlignment = Enum.HorizontalAlignment.Center}
                            ),
                            Create("UIPadding", {PaddingBottom = UDim.new(0, 10)})
                        }
                    )
                }
            )
            ApplyBaseUX(Sect, SectCont.C)
            return Sect
        end

        ApplyBaseUX(Tab, Page)
        Tab.TabBtn = TabBtn
        Tab.Page = Page
        table.insert(Window.Tabs, Tab)
        if #Window.Tabs == 1 then
            Tab:Select()
        end
        return Tab
    end

    return Window
end

return Seraph
