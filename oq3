local Seraph = {
    Themes = {
        Pure = {
            Main = Color3.fromRGB(9, 9, 11),
            Sub = Color3.fromRGB(13, 13, 16),
            Stroke = Color3.fromRGB(32, 32, 35),
            Accent = Color3.fromRGB(255, 255, 255),
            Text = Color3.fromRGB(200, 200, 200),
            SecondaryText = Color3.fromRGB(110, 110, 115)
        }
    }
}

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local Parent = (gethui and gethui()) or CoreGui

local function QuickTween(obj, properties, duration)
    TweenService:Create(obj, TweenInfo.new(duration or 0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), properties):Play()
end

local function Create(class, props, children)
    local obj = Instance.new(class)
    for i, v in pairs(props) do
        obj[i] = v
    end
    if children then
        for _, child in pairs(children) do
            child.Parent = obj
        end
    end
    return obj
end

function Seraph:CreateWindow(cfg)
    cfg = cfg or {}
    local Title = cfg.Title or "SERAPH"
    
    local GUI = Create("ScreenGui", { Name = "SeraphV2", Parent = Parent, IgnoreGuiInset = true, ResetOnSpawn = false })
    
    local Main = Create("Frame", {
        Name = "Main",
        Size = UDim2.new(0, 560, 0, 420),
        Position = UDim2.new(0.5, -280, 0.5, -210),
        BackgroundColor3 = Seraph.Themes.Pure.Main,
        BorderSizePixel = 0,
        ClipsDescendants = true,
        Parent = GUI
    }, {
        Create("UICorner", { CornerRadius = UDim.new(0, 10) }),
        Create("UIStroke", { Color = Seraph.Themes.Pure.Stroke, Thickness = 1.2 })
    })

    local Topbar = Create("Frame", {
        Name = "Topbar",
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundColor3 = Seraph.Themes.Pure.Sub,
        BackgroundTransparency = 0.4,
        BorderSizePixel = 0,
        Parent = Main
    }, {
        Create("UICorner", { CornerRadius = UDim.new(0, 10) }),
        Create("Frame", { -- Divider line
            Size = UDim2.new(1, 0, 0, 1),
            Position = UDim2.new(0, 0, 1, 0),
            BackgroundColor3 = Seraph.Themes.Pure.Stroke,
            BorderSizePixel = 0
        }),
        Create("TextLabel", {
            Name = "Title",
            Text = Title:upper(),
            Size = UDim2.new(0, 200, 1, 0),
            Position = UDim2.new(0, 20, 0, 0),
            TextColor3 = Seraph.Themes.Pure.Accent,
            TextSize = 14,
            Font = Enum.Font.RobotoMono,
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    })

    -- Fixed Dragging Logic
    local dragging, dragInput, dragStart, startPos
    Topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    local Nav = Create("Frame", {
        Name = "Nav",
        Size = UDim2.new(0, 150, 1, -51),
        Position = UDim2.new(0, 0, 0, 51),
        BackgroundColor3 = Seraph.Themes.Pure.Sub,
        BorderSizePixel = 0,
        Parent = Main
    }, {
        Create("UICorner", { CornerRadius = UDim.new(0, 10) }),
        Create("Frame", { -- Vertical Divider
            Size = UDim2.new(0, 1, 1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            BackgroundColor3 = Seraph.Themes.Pure.Stroke,
            BorderSizePixel = 0
        })
    })

    local NavHighlighter = Create("Frame", {
        Size = UDim2.new(0, 2, 0, 16),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Seraph.Themes.Pure.Accent,
        Visible = false,
        ZIndex = 5,
        Parent = Nav
    })

    local NavItems = Create("ScrollingFrame", {
        Size = UDim2.new(1, 0, 1, -20),
        Position = UDim2.new(0, 0, 0, 10),
        BackgroundTransparency = 1,
        ScrollBarThickness = 0,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        Parent = Nav
    }, { Create("UIListLayout", { Padding = UDim.new(0, 5), HorizontalAlignment = Enum.HorizontalAlignment.Center }) })

    local Content = Create("Frame", {
        Name = "Content",
        Size = UDim2.new(1, -160, 1, -60),
        Position = UDim2.new(0, 160, 0, 60),
        BackgroundTransparency = 1,
        Parent = Main
    })

    local Window = { Tabs = {}, SelectedTab = nil }

    function Window:AddTab(title)
        local TabObj = { Btn = nil, Page = nil }
        
        local TabBtn = Create("TextButton", {
            Text = title,
            Size = UDim2.new(1, -20, 0, 30),
            BackgroundTransparency = 1,
            TextColor3 = Seraph.Themes.Pure.SecondaryText,
            Font = Enum.Font.Gotham,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = NavItems
        }, { Create("UIPadding", { PaddingLeft = UDim.new(0, 10) }) })

        local TabPage = Create("ScrollingFrame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Visible = false,
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Seraph.Themes.Pure.Stroke,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Parent = Content
        }, { 
            Create("UIListLayout", { Padding = UDim.new(0, 8), HorizontalAlignment = Enum.HorizontalAlignment.Center }),
            Create("UIPadding", { PaddingBottom = UDim.new(0, 10), PaddingTop = UDim.new(0, 2) }) 
        })

        local function Select()
            for _, t in pairs(Window.Tabs) do
                t.Page.Visible = false
                QuickTween(t.Btn, { TextColor3 = Seraph.Themes.Pure.SecondaryText })
            end
            TabPage.Visible = true
            QuickTween(TabBtn, { TextColor3 = Seraph.Themes.Pure.Accent })
            
            NavHighlighter.Visible = true
            QuickTween(NavHighlighter, { Position = UDim2.new(0, 0, 0, TabBtn.Position.Y.Offset + 7) }, 0.2)
        end

        TabBtn.MouseButton1Click:Connect(Select)

        TabObj.Btn = TabBtn
        TabObj.Page = TabPage
        table.insert(Window.Tabs, TabObj)

        -- Select first tab automatically
        if #Window.Tabs == 1 then
            task.spawn(Select)
        end

        function TabObj:AddButton(txt, cb)
            local cb = cb or function() end
            local Btn = Create("TextButton", {
                Text = "",
                Size = UDim2.new(1, -20, 0, 35),
                BackgroundColor3 = Seraph.Themes.Pure.Sub,
                AutoButtonColor = false,
                Parent = TabPage
            }, {
                Create("UICorner", { CornerRadius = UDim.new(0, 4) }),
                Create("UIStroke", { Color = Seraph.Themes.Pure.Stroke, Thickness = 1 }),
                Create("TextLabel", {
                    Text = txt,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Seraph.Themes.Pure.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13
                })
            })
            Btn.MouseButton1Click:Connect(function()
                QuickTween(Btn, { BackgroundColor3 = Seraph.Themes.Pure.Stroke }, 0.1)
                task.wait(0.1)
                QuickTween(Btn, { BackgroundColor3 = Seraph.Themes.Pure.Sub }, 0.1)
                task.spawn(cb)
            end)
        end

        function TabObj:AddToggle(txt, def, cb)
            local state = def or false
            local cb = cb or function() end
            
            local Tgl = Create("TextButton", {
                Text = "",
                Size = UDim2.new(1, -20, 0, 40),
                BackgroundColor3 = Seraph.Themes.Pure.Sub,
                AutoButtonColor = false,
                Parent = TabPage
            }, {
                Create("UICorner", { CornerRadius = UDim.new(0, 4) }),
                Create("UIStroke", { Color = Seraph.Themes.Pure.Stroke, Thickness = 1 }),
                Create("TextLabel", {
                    Text = txt,
                    Size = UDim2.new(1, -50, 1, 0),
                    Position = UDim2.new(0, 15, 0, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Seraph.Themes.Pure.Text,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Font = Enum.Font.Gotham,
                    TextSize = 13
                })
            })

            local Indicator = Create("Frame", {
                Size = UDim2.new(0, 14, 0, 14),
                Position = UDim2.new(1, -30, 0.5, -7),
                BackgroundColor3 = state and Seraph.Themes.Pure.Accent or Seraph.Themes.Pure.Main,
                Parent = Tgl
            }, { 
                Create("UICorner", { CornerRadius = UDim.new(1, 0) }),
                Create("UIStroke", { Color = Seraph.Themes.Pure.Stroke, Thickness = 1 }) 
            })

            Tgl.MouseButton1Click:Connect(function()
                state = not state
                QuickTween(Indicator, { BackgroundColor3 = state and Seraph.Themes.Pure.Accent or Seraph.Themes.Pure.Main }, 0.2)
                task.spawn(cb, state)
            end)
        end

        function TabObj:AddSlider(txt, min, max, def, cb)
            local val = def or min
            local cb = cb or function() end
            
            local Slider = Create("Frame", {
                Size = UDim2.new(1, -20, 0, 50),
                BackgroundColor3 = Seraph.Themes.Pure.Sub,
                Parent = TabPage
            }, {
                Create("UICorner", { CornerRadius = UDim.new(0, 4) }),
                Create("UIStroke", { Color = Seraph.Themes.Pure.Stroke, Thickness = 1 }),
                Create("TextLabel", {
                    Text = txt,
                    Size = UDim2.new(1, -50, 0, 25),
                    Position = UDim2.new(0, 15, 0, 5),
                    BackgroundTransparency = 1,
                    TextColor3 = Seraph.Themes.Pure.SecondaryText,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Font = Enum.Font.Gotham,
                    TextSize = 11
                })
            })

            local Bar = Create("Frame", {
                Size = UDim2.new(1, -30, 0, 4),
                Position = UDim2.new(0, 15, 0, 35),
                BackgroundColor3 = Seraph.Themes.Pure.Main,
                BorderSizePixel = 0,
                Parent = Slider
            }, { Create("UICorner", { CornerRadius = UDim.new(1, 0) }) })

            local Fill = Create("Frame", {
                Size = UDim2.new(math.clamp((val - min) / (max - min), 0, 1), 0, 1, 0),
                BackgroundColor3 = Seraph.Themes.Pure.Accent,
                BorderSizePixel = 0,
                Parent = Bar
            }, { Create("UICorner", { CornerRadius = UDim.new(1, 0) }) })

            local ValText = Create("TextLabel", {
                Text = tostring(val),
                Size = UDim2.new(0, 40, 0, 25),
                Position = UDim2.new(1, -50, 0, 5),
                BackgroundTransparency = 1,
                TextColor3 = Seraph.Themes.Pure.Accent,
                Font = Enum.Font.RobotoMono,
                TextSize = 12,
                Parent = Slider
            })

            local isMoving = false
            local function Update(input)
                local pos = math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                local new_val = math.floor(min + (max - min) * pos)
                ValText.Text = tostring(new_val)
                Fill.Size = UDim2.new(pos, 0, 1, 0)
                if new_val ~= val then
                    val = new_val
                    task.spawn(cb, val)
                end
            end

            Slider.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    isMoving = true
                    Update(input)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if isMoving and input.UserInputType == Enum.UserInputType.MouseMovement then
                    Update(input)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    isMoving = false
                end
            end)
        end

        return TabObj
    end

    return Window
end

return Seraph
