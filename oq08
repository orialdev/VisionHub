local Seraph = {
    Themes = {
        Pure = {
            Main = Color3.fromRGB(13, 13, 15),
            Sub = Color3.fromRGB(18, 18, 22),
            Section = Color3.fromRGB(20, 20, 24),
            Component = Color3.fromRGB(25, 25, 30),
            Stroke = Color3.fromRGB(40, 40, 45),
            Accent = Color3.fromRGB(120, 110, 255),
            Text = Color3.fromRGB(255, 255, 255),
            SecondaryText = Color3.fromRGB(160, 160, 170),
            Hover = Color3.fromRGB(45, 45, 55),
            Risk = Color3.fromRGB(255, 80, 80)
        }
    }
}

--// Services
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local Parent =
    (RunService:IsStudio() and Players.LocalPlayer:WaitForChild("PlayerGui")) or (gethui and gethui()) or CoreGui

--// Internal Utilities
local function Create(class, props, children)
    local obj = Instance.new(class)
    for i, v in pairs(props) do
        if i ~= "Parent" then
            obj[i] = v
        end
    end
    if children then
        for _, child in ipairs(children) do
            child.Parent = obj
        end
    end
    obj.Parent = props.Parent
    return obj
end

local function Tween(obj, info, goal)
    local t = TweenService:Create(obj, TweenInfo.new(unpack(info)), goal)
    t:Play()
    return t
end

--// Notification System
local NotifyHolder =
    Create(
    "Frame",
    {
        Name = "SeraphNotifications",
        Parent = Parent:FindFirstChild("SeraphV4") or Create("ScreenGui", {Name = "SeraphV4", Parent = Parent}),
        Size = UDim2.new(0, 300, 1, 0),
        Position = UDim2.new(1, -310, 0, 0),
        BackgroundTransparency = 1
    },
    {
        Create(
            "UIListLayout",
            {
                VerticalAlignment = Enum.VerticalAlignment.Bottom,
                Padding = UDim.new(0, 10)
            }
        ),
        Create("UIPadding", {PaddingBottom = UDim.new(0, 20)})
    }
)

function Seraph:Notify(title, desc, duration)
    local Theme = Seraph.Themes.Pure
    local duration = duration or 5

    local Notif =
        Create(
        "Frame",
        {
            Parent = NotifyHolder,
            Size = UDim2.new(1, 0, 0, 0),
            BackgroundColor3 = Theme.Sub,
            ClipsDescendants = true
        },
        {
            Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
            Create("UIStroke", {Color = Theme.Stroke}),
            Create(
                "Frame",
                {
                    Name = "Progress",
                    Size = UDim2.new(1, 0, 0, 2),
                    Position = UDim2.new(0, 0, 1, -2),
                    BackgroundColor3 = Theme.Accent,
                    BorderSizePixel = 0
                }
            ),
            Create(
                "TextLabel",
                {
                    Text = title,
                    Size = UDim2.new(1, -20, 0, 25),
                    Position = UDim2.new(0, 10, 0, 5),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.GothamBold,
                    TextSize = 13,
                    TextXAlignment = "Left"
                }
            ),
            Create(
                "TextLabel",
                {
                    Text = desc,
                    Size = UDim2.new(1, -20, 0, 20),
                    Position = UDim2.new(0, 10, 0, 25),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.SecondaryText,
                    Font = Enum.Font.Gotham,
                    TextSize = 11,
                    TextXAlignment = "Left",
                    TextWrapped = true
                }
            )
        }
    )

    Tween(Notif, {0.4, Enum.EasingStyle.Quart}, {Size = UDim2.new(1, 0, 0, 60)})
    Tween(Notif.Progress, {duration, Enum.EasingStyle.Linear}, {Size = UDim2.new(0, 0, 0, 2)})

    task.delay(
        duration,
        function()
            Tween(Notif, {0.4, Enum.EasingStyle.Quart}, {Size = UDim2.new(1, 0, 0, 0)})
            task.wait(0.5)
            Notif:Destroy()
        end
    )
end

function Seraph:CreateWindow(cfg)
    cfg = cfg or {}
    local Theme = Seraph.Themes.Pure
    local GUI =
        Parent:FindFirstChild("SeraphV4") or
        Create("ScreenGui", {Name = "SeraphV4", Parent = Parent, IgnoreGuiInset = true})

    local MainSize = Vector2.new(620, 480)
    local Main =
        Create(
        "CanvasGroup",
        {
            Name = "Main",
            Size = UDim2.new(0, MainSize.X, 0, MainSize.Y),
            Position = UDim2.new(0.5, -MainSize.X / 2, 0.5, -MainSize.Y / 2),
            BackgroundColor3 = Theme.Main,
            Parent = GUI,
            GroupTransparency = 1
        },
        {
            Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
            Create("UIStroke", {Color = Theme.Stroke, Thickness = 1.2})
        }
    )

    Tween(Main, {0.5, Enum.EasingStyle.Quart}, {GroupTransparency = 0})

    --// Dragging Logic (Advanced Smooth Lerp)
    local dragInput, dragStart, startPos
    local dragging = false

    Main.InputBegan:Connect(
        function(input)
            if
                (input.UserInputType == Enum.UserInputType.MouseButton1 or
                    input.UserInputType == Enum.UserInputType.Touch)
             then
                dragging = true
                dragStart = input.Position
                startPos = Main.Position
            end
        end
    )

    UserInputService.InputChanged:Connect(
        function(input)
            if
                dragging and
                    (input.UserInputType == Enum.UserInputType.MouseMovement or
                        input.UserInputType == Enum.UserInputType.Touch)
             then
                local delta = input.Position - dragStart
                Tween(
                    Main,
                    {0.15, Enum.EasingStyle.Linear},
                    {
                        Position = UDim2.new(
                            startPos.X.Scale,
                            startPos.X.Offset + delta.X,
                            startPos.Y.Scale,
                            startPos.Y.Offset + delta.Y
                        )
                    }
                )
            end
        end
    )

    UserInputService.InputEnded:Connect(
        function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = false
            end
        end
    )

    --// Sidebar & Containers
    local Sidebar =
        Create(
        "Frame",
        {
            Size = UDim2.new(0, 180, 1, -40),
            Position = UDim2.new(0, 0, 0, 40),
            BackgroundColor3 = Theme.Sub,
            BorderSizePixel = 0,
            Parent = Main
        },
        {
            Create(
                "Frame",
                {
                    -- Divider
                    Size = UDim2.new(0, 1, 1, 0),
                    Position = UDim2.new(1, 0, 0, 0),
                    BackgroundColor3 = Theme.Stroke,
                    BorderSizePixel = 0
                }
            )
        }
    )

    local TabHolder =
        Create(
        "ScrollingFrame",
        {
            Size = UDim2.new(1, 0, 1, -10),
            Position = UDim2.new(0, 0, 0, 5),
            BackgroundTransparency = 1,
            ScrollBarThickness = 0,
            AutomaticCanvasSize = "Y",
            Parent = Sidebar
        },
        {
            Create("UIListLayout", {Padding = UDim.new(0, 4), HorizontalAlignment = "Center"})
        }
    )

    local Container =
        Create(
        "Frame",
        {
            Size = UDim2.new(1, -195, 1, -55),
            Position = UDim2.new(0, 190, 0, 50),
            BackgroundTransparency = 1,
            Parent = Main
        }
    )

    --// Header
    local TopBar =
        Create(
        "Frame",
        {
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = Theme.Sub,
            Parent = Main
        },
        {
            Create(
                "TextLabel",
                {
                    Text = (cfg.Title or "SERAPH"):upper(),
                    Size = UDim2.new(0, 0, 1, 0),
                    Position = UDim2.new(0, 40, 0, 0),
                    AutomaticSize = "X",
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.GothamBold,
                    TextSize = 14
                }
            )
        }
    )

    local Window = {Tabs = {}, ActiveTab = nil}

    local function ApplyBaseUX(object, target)
        --// Button
        function object:AddButton(text, callback)
            local Btn =
                Create(
                "TextButton",
                {
                    Text = text,
                    Size = UDim2.new(1, -10, 0, 36),
                    BackgroundColor3 = Theme.Component,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.GothamMedium,
                    TextSize = 13,
                    AutoButtonColor = false,
                    Parent = target
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
                    Create("UIStroke", {Color = Theme.Stroke})
                }
            )

            Btn.MouseEnter:Connect(
                function()
                    Tween(Btn, {0.2}, {BackgroundColor3 = Theme.Hover})
                end
            )
            Btn.MouseLeave:Connect(
                function()
                    Tween(Btn, {0.2}, {BackgroundColor3 = Theme.Component})
                end
            )
            Btn.MouseButton1Down:Connect(
                function()
                    Tween(Btn, {0.1}, {Size = UDim2.new(1, -15, 0, 32)})
                end
            )
            Btn.MouseButton1Up:Connect(
                function()
                    Tween(Btn, {0.1}, {Size = UDim2.new(1, -10, 0, 36)})
                    task.spawn(callback)
                end
            )
            return Btn
        end

        --// Toggle
        function object:AddToggle(text, default, callback)
            local state = default or false
            local Togg =
                Create(
                "TextButton",
                {
                    Text = "",
                    Size = UDim2.new(1, -10, 0, 38),
                    BackgroundColor3 = Theme.Component,
                    AutoButtonColor = false,
                    Parent = target
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
                    Create("UIStroke", {Color = Theme.Stroke, ApplyStrokeMode = "Border"}),
                    Create(
                        "TextLabel",
                        {
                            Text = text,
                            Size = UDim2.new(1, -60, 1, 0),
                            Position = UDim2.new(0, 12, 0, 0),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.Text,
                            Font = Enum.Font.Gotham,
                            TextSize = 13,
                            TextXAlignment = "Left"
                        }
                    ),
                    Create(
                        "Frame",
                        {
                            Name = "Switch",
                            Size = UDim2.new(0, 34, 0, 18),
                            Position = UDim2.new(1, -45, 0.5, -9),
                            BackgroundColor3 = state and Theme.Accent or Theme.Main
                        },
                        {
                            Create("UICorner", {CornerRadius = UDim.new(1, 0)}),
                            Create(
                                "Frame",
                                {
                                    Name = "Ball",
                                    Size = UDim2.new(0, 14, 0, 14),
                                    Position = state and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7),
                                    BackgroundColor3 = Color3.new(1, 1, 1)
                                },
                                {Create("UICorner", {CornerRadius = UDim.new(1, 0)})}
                            )
                        }
                    )
                }
            )

            Togg.MouseButton1Click:Connect(
                function()
                    state = not state
                    Tween(Togg.Switch, {0.2}, {BackgroundColor3 = state and Theme.Accent or Theme.Main})
                    Tween(
                        Togg.Switch.Ball,
                        {0.2},
                        {Position = state and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)}
                    )
                    task.spawn(callback, state)
                end
            )
        end

        --// Dropdown
        function object:AddDropdown(text, list, callback)
            local dropped = false
            local Drop =
                Create(
                "Frame",
                {
                    Size = UDim2.new(1, -10, 0, 38),
                    BackgroundColor3 = Theme.Component,
                    ClipsDescendants = true,
                    Parent = target
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
                    Create("UIStroke", {Color = Theme.Stroke}),
                    Create(
                        "TextButton",
                        {
                            Name = "Trigger",
                            Size = UDim2.new(1, 0, 0, 38),
                            BackgroundTransparency = 1,
                            Text = ""
                        }
                    ),
                    Create(
                        "TextLabel",
                        {
                            Name = "Selected",
                            Text = text .. ": ...",
                            Size = UDim2.new(1, -40, 0, 38),
                            Position = UDim2.new(0, 12, 0, 0),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.SecondaryText,
                            Font = Enum.Font.Gotham,
                            TextSize = 13,
                            TextXAlignment = "Left"
                        }
                    ),
                    Create(
                        "Frame",
                        {
                            Name = "Container",
                            Size = UDim2.new(1, 0, 0, #list * 30),
                            Position = UDim2.new(0, 0, 0, 38),
                            BackgroundTransparency = 1
                        },
                        {
                            Create("UIListLayout", {Padding = UDim.new(0, 0)})
                        }
                    )
                }
            )

            for _, val in pairs(list) do
                local Item =
                    Create(
                    "TextButton",
                    {
                        Text = tostring(val),
                        Size = UDim2.new(1, 0, 0, 30),
                        BackgroundTransparency = 1,
                        TextColor3 = Theme.SecondaryText,
                        Font = Enum.Font.Gotham,
                        TextSize = 12,
                        Parent = Drop.Container
                    }
                )
                Item.MouseButton1Click:Connect(
                    function()
                        Drop.Selected.Text = text .. ": " .. tostring(val)
                        dropped = false
                        Tween(Drop, {0.3, Enum.EasingStyle.Quart}, {Size = UDim2.new(1, -10, 0, 38)})
                        task.spawn(callback, val)
                    end
                )
            end

            Drop.Trigger.MouseButton1Click:Connect(
                function()
                    dropped = not dropped
                    Tween(
                        Drop,
                        {0.3, Enum.EasingStyle.Quart},
                        {Size = dropped and UDim2.new(1, -10, 0, 45 + (#list * 30)) or UDim2.new(1, -10, 0, 38)}
                    )
                end
            )
        end
    end

    function Window:AddTab(name)
        local Tab = {Page = nil, TabBtn = nil}
        local TabBtn =
            Create(
            "TextButton",
            {
                Text = "",
                Size = UDim2.new(1, -15, 0, 36),
                BackgroundTransparency = 1,
                Parent = TabHolder
            },
            {
                Create(
                    "TextLabel",
                    {
                        Name = "Label",
                        Text = name,
                        Size = UDim2.new(1, -10, 1, 0),
                        Position = UDim2.new(0, 12, 0, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = Theme.SecondaryText,
                        TextSize = 13,
                        Font = Enum.Font.GothamMedium,
                        TextXAlignment = "Left"
                    }
                ),
                Create(
                    "Frame",
                    {
                        Name = "Accent",
                        Size = UDim2.new(0, 2, 0.6, 0),
                        Position = UDim2.new(0, 0, 0.2, 0),
                        BackgroundColor3 = Theme.Accent,
                        Visible = false
                    }
                )
            }
        )

        local Page =
            Create(
            "ScrollingFrame",
            {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Visible = false,
                ScrollBarThickness = 0,
                AutomaticCanvasSize = "Y",
                Parent = Container
            },
            {
                Create("UIListLayout", {Padding = UDim.new(0, 10), HorizontalAlignment = "Center"})
            }
        )

        function Tab:Select()
            if Window.ActiveTab then
                Window.ActiveTab.Page.Visible = false
                Window.ActiveTab.TabBtn.Label.TextColor3 = Theme.SecondaryText
                Window.ActiveTab.TabBtn.Accent.Visible = false
            end
            Window.ActiveTab = Tab
            Page.Visible = true
            TabBtn.Label.TextColor3 = Theme.Text
            TabBtn.Accent.Visible = true
        end

        TabBtn.MouseButton1Click:Connect(
            function()
                Tab:Select()
            end
        )

        function Tab:AddSection(title)
            local Sect = {}
            local SectCont =
                Create(
                "Frame",
                {
                    Size = UDim2.new(1, -10, 0, 0),
                    BackgroundColor3 = Theme.Section,
                    AutomaticSize = "Y",
                    Parent = Page
                },
                {
                    Create("UICorner", {CornerRadius = UDim.new(0, 7)}),
                    Create("UIStroke", {Color = Theme.Stroke}),
                    Create(
                        "TextLabel",
                        {
                            Text = title:upper(),
                            Size = UDim2.new(1, -12, 0, 30),
                            Position = UDim2.new(0, 12, 0, 2),
                            BackgroundTransparency = 1,
                            TextColor3 = Theme.Accent,
                            Font = Enum.Font.GothamBold,
                            TextSize = 11,
                            TextXAlignment = "Left"
                        }
                    ),
                    Create(
                        "Frame",
                        {
                            Name = "Content",
                            Size = UDim2.new(1, 0, 0, 0),
                            Position = UDim2.new(0, 0, 0, 32),
                            BackgroundTransparency = 1,
                            AutomaticSize = "Y"
                        },
                        {
                            Create("UIListLayout", {Padding = UDim.new(0, 6), HorizontalAlignment = "Center"}),
                            Create("UIPadding", {PaddingBottom = UDim.new(0, 10)})
                        }
                    )
                }
            )
            ApplyBaseUX(Sect, SectCont.Content)
            return Sect
        end

        ApplyBaseUX(Tab, Page)
        Tab.TabBtn = TabBtn
        Tab.Page = Page
        table.insert(Window.Tabs, Tab)
        if #Window.Tabs == 1 then
            Tab:Select()
        end
        return Tab
    end

    return Window
end

return Seraph
